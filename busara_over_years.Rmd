---
title: "Download Dashboard"
author: "Rémi Thériault"
output: html_document
---

Successfully knitted.

# Setup

```{r setup}
library(pubmedDashboard)
library(dplyr)
API_TOKEN_PUBMED <- keyring::key_get("pubmed", "rempsyc")
```

# PlosOne

```{r plosone, eval=F}
setwd("data/plosone")

# Dealing with PLOS journal (only starts in 2007)
# lapply(2011:2022, \(x) {
lapply(2011, \(x) {
  lapply(1:12, \(y) {
    save_process_pubmed_batch(
      journal = "Plos one",
      year_low = x,
      year_high = x,
      month_low = y,
      month_high = y,
      api_key = API_TOKEN_PUBMED)
    })
})

# Breaks after year 2011...
save_process_pubmed_batch(
      journal = "Plos one",
      year_low = 2011,
      year_high = 2011,
      month_low = "01",
      month_high = "01",
      day_low = "01",
      day_high = "01",
      api_key = API_TOKEN_PUBMED)

setwd("data")
a <- list.files(pattern = "^articles_.*$")
b <- gsub(".rds", "_plos.rds", a)
file.rename(a, b)
file.copy(b, "C:/github/busara_dashboard/data", overwrite = TRUE)
setwd("..")
setwd("..")
```

# PNAS

```{r pnas, eval=F}
setwd("data/pnas")
# Dealing with PNAS journal
lapply(1980:2023, \(x) {
  save_process_pubmed_batch(
    journal = "Proceedings of the National Academy of Sciences of the United States of America",
    year_low = x,
    year_high = x,
    api_key = API_TOKEN_PUBMED)
})

setwd("data")
a <- list.files(pattern = "^articles_.*$")
b <- gsub(".rds", "_pnas.rds", a)
file.rename(a, b)
file.copy(b, "C:/github/busara_dashboard/data", overwrite = TRUE)
setwd("..")
setwd("..")
```

# Nature

```{r nature, eval=F}
setwd("data/nature")
# Dealing with Nature journal
lapply(1980:2023, \(x) {
  save_process_pubmed_batch(
    journal = "Nature",
    year_low = x,
    year_high = x,
    api_key = API_TOKEN_PUBMED)
})

setwd("data")
a <- list.files(pattern = "^articles_.*$")
b <- gsub(".rds", "_nature.rds", a)
file.rename(a, b)
file.copy(b, "C:/github/busara_dashboard/data", overwrite = TRUE)
setwd("..")
setwd("..")
```

# Science

```{r science, eval=F}
setwd("data/science")
# Dealing with Science journal
lapply(1980:2023, \(x) {
  save_process_pubmed_batch(
    journal = "Science (New York, N.Y.)",
    year_low = x,
    year_high = x,
    api_key = API_TOKEN_PUBMED)
})

setwd("data")
a <- list.files(pattern = "^articles_.*$")
b <- gsub(".rds", "_science.rds", a)
file.rename(a, b)
file.copy(b, "C:/github/busara_dashboard/data", overwrite = TRUE)
setwd("..")
setwd("..")
```

# Psychology

```{r psychology, eval=T}
setwd("data/psychology")
# Dealing with all other journals
lapply(1980:2023, \(x) {
  save_process_pubmed_batch(
    journal = journal_field %>% 
      filter(field == "psychology") %>% 
      pull(journal),
    year_low = x,
    year_high = x,
    api_key = API_TOKEN_PUBMED)
})

setwd("data")
a <- list.files(pattern = "^articles_.*$")
b <- gsub(".rds", "_psychology.rds", a)
file.rename(a, b)
file.copy(b, "C:/github/busara_dashboard/data", overwrite = TRUE)
setwd("..")
setwd("..")

```

# Economics

```{r economics, eval=T}
setwd("data/economics")
# Dealing with all other journals
lapply(1980:2023, \(x) {
  save_process_pubmed_batch(
    journal = journal_field %>% 
      filter(field == "economics") %>% 
      pull(journal),
    year_low = x,
    year_high = x,
    api_key = API_TOKEN_PUBMED)
})

setwd("data")
a <- list.files(pattern = "^articles_.*$")
b <- gsub(".rds", "_economics.rds", a)
file.rename(a, b)
file.copy(b, "C:/github/busara_dashboard/data", overwrite = TRUE)
setwd("..")
setwd("..")

```

```{r clean}
unlink("data/easyPubMed_data_01.txt")
unlink("data/easyPubMed_data_02.txt")
unlink("data/easyPubMed_data_03.txt")
```

